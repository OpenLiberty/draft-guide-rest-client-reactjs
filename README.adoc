// Copyright (c) 2020 IBM Corporation and others.
// Licensed under Creative Commons Attribution-NoDerivatives
// 4.0 International (CC BY-ND 4.0)
//   https://creativecommons.org/licenses/by-nd/4.0/
//
// Contributors:
//     IBM Corporation
:projectid: rest-client-reactjs
:page-layout: guide-multipane
:page-duration: 20 minutes
:page-description: Explore how to access a simple RESTful web service and consume its resources with ReactJS in Open Liberty.
// :page-releasedate: ...
:page-related-guides: ['rest-intro', 'rest-client-java']
:page-permalink: /guides/{projectid}
:imagesdir: /img/guide/{projectid}
:common-includes: https://raw.githubusercontent.com/OpenLiberty/guides-common/master
:source-highlighter: prettify
:page-seo-title: Consuming a RESTful Java web service with ReactJS
:page-seo-description: A getting started tutorial with examples on how to access a RESTful Java micoservice and deserialize the returned JSON in ReactJS.
:guide-author: Open Liberty
= Consuming a RESTful web service with ReactJS

[.hidden]
NOTE: This repository contains the guide documentation source. To view the guide in published form, view it on the https://openliberty.io/guides/{projectid}.html[Open Liberty website].

Explore how to access a simple RESTful web service and consume its resources with ReactJS in Open
Liberty.

// =================================================================================================
// What you'll learn
// =================================================================================================

== What you'll learn 

You will learn how to access a REST service and deserialize the returned JSON that contains a list of artists, their albums and other ambiguous artist features by using an HTTP client with the ReactJS library. You will then present this data using a ReactJS element in the form of a paginated table.

https://reactjs.org/[ReactJS^] is a JavaScript library used to build user interfaces. Its main purpose is to incorporate a component-based approach to create reusable UI elements. https://reactjs.org/[ReactJS^] also allows you to interface with other libraries and frameworks. Note, the names ReactJS and React are used interchangeably.

The React application in this guide is provided and configured for you in the `frontend` directory. The application uses the https://reactjs.org/docs/create-a-new-react-app.html[Create React App] prebuilt configuration to design the modern single-page React application. The [https://github.com/facebook/create-react-app]`create-react-app` integrated toolchain is a comfortable environment for learning React, and is the best way to start building a new single-page application in React.

artists.json
[source, json, linenums, role="code_column"]
----
include::finish/src/resources/artists.json[]
----

The REST service that provides the resources was written for you in advance in the backend of the application, and responds with the [hotspot]`artists.json` in `src/resources`. You will implement a ReactJS client that consumes this JSON and displays its contents on a single-page webpage, which will act as your application's frontend. 

To learn more about REST services and how you can write them, see
https://openliberty.io/guides/rest-intro.html[Creating a RESTful web service^].

// =================================================================================================
// Getting Started
// =================================================================================================
[role='command']
include::{common-includes}/gitclone.adoc[]

// =================================================================================================
// Try what you'll build
// =================================================================================================

=== Try what you'll build

The `finish` directory in the root of this guide contains the finished application. Give it a try before you proceed. The React frontend is already pre-built for you and the static files from the production build can be found in `webapp/static`.

To try out the application, run the following Maven goal to build the application and deploy it to Open Liberty:

[role='command']
```
mvn liberty:run
```

After you see the following message, your application server is ready.

[role="no_copy"]
----
The defaultServer server is ready to run a smarter planet.
----

Then, point your browser to the web application root http://localhost:9080[http://localhost:9080^] to see the following output:

image::react-table.png[React Paginated Table,align="center"]

[role='command']
include::{common-includes}/twyb-end.adoc[]

// =================================================================================================
// Starting the service
// =================================================================================================

== Starting the service

Before you begin the implementation, start the provided REST service so that
the artist JSON is available to you.

Navigate to the `start` directory to begin.

[role='command']
include::{common-includes}/devmode-start.adoc[]

After you start the service, you can find your artist JSON at the
http://localhost:9080/artists[http://localhost:9080/artists^] URL. 
If you later decide to update the REST service data in the [hotspot file]`artist.json`
for your frontend application, it will automatically be picked by the Open Liberty server.

artists.json
[source, json, linenums, role="code_column"]
----
include::finish/src/resources/artists.json[]
----

Note: all the other dependencies that are installed in the project will show up in `frontend/src/package.json`
that was generated with `create-react-app`.

// =================================================================================================
// Project Configuration
// =================================================================================================

== Project Configuration
=== Frontend 

A React web application is simply a collection of components. Each component does a specific functionality. You will create the components that are used in the application to acquire and display data from the JAX-RS API. 

App.js
[source, javascript, linenums, role='code_column']
----
include::finish/src/main/frontend/src/App.js[]
----

index.js
[source, javascript, linenums, role='code_column']
----
include::finish/src/main/frontend/src/index.js[]
----

The main component in React is the `App` Component. You will need to create the [hotspot file=0]`App.js` file which acts as a container for all other components. The `App.js` file returns the `Display` component as a [hotspot=react-fragment file=0]`React Fragment` to create a reusable element that encompasses your web application.

[role="code_command hotspot file=0", subs="quotes"]
----
#Create the `App.js` file.#
`src/main/frontend/src/Components/App.js`
----

You will need to create the entry point of your React application. In production, when the frontend application is used by other applications, the [hotspot file=1]`index.js` file should be the main entry point of the application as it coincides with the `index.html` file. This is where your code is always going to be run. 

[role="code_command hotspot file=1", subs="quotes"]
----
#Create the `index.js` file.#
`src/main/frontend/src/Components/App.js`
----

The performance benefit in using React is evident through the Virtual DOM that it offers, which is essentially a copy of the browser DOM that resides in memory. The Virtual DOM improves the performance of your web application as it plays a crucial role in the rendering process. The https://reactjs.org/docs/react-dom.html[react-dom^] package provides DOM-specific methods that can be used in your application to get outside of the React model, if necessary. See, https://reactjs.org/docs/react-dom.html[ReactDOM^] to learn more about the Virtual DOM. 

To render the element that was made onto your webpage, the [hotspot=dom-render file=1]`render` method is provided by the DOM. Here, we rendered the `App` element on a DOM node.

=== Backend
The static files that will be produced from the optimized production build are generated through the [hotspot=node-resources]`node resources`, and they are sent to the backend of the application.

You need to add the configuration that will copy the frontend static files to target directory. 

pom.xml
[source, xml, linenums, role='code_column']
----
include::finish/pom.xml[]
----

[role="code_command hotspot", subs="quotes"]
----
#Update the `pom.xml` file.#
`pom.xml`
----
[role="edit_command_text"]
Add the [hotspot=copy-plugin]`Maven resource plugin` to your project configuration.

// =================================================================================================
// Creating your React components
// =================================================================================================

== Creating your React components

Fetchdata.js
[source, javascript, linenums, role='code_column']
----
include::finish/src/main/frontend/src/Components/Fetchdata.js[]
----

App.js
[source, javascript, linenums, role='code_column']
----
include::finish/src/main/frontend/src/App.js[]
----

The [hotspot=react-library file=0]`React library` imports the `default export` from the `react` package, and the `component named export` from the package. An inheritance to the React Component is created to write the [hotspot=class file=0]`Fetchdata` component.

The [hotspot=state-object file=0]`state` object is initialized to represent the state of the posts that will appear on the paginated table. The `Fetchdata` component also needs to be [hotspot=export-fetchdata file=0]`exported` as a reusable UI element that can be used across your application.

// =================================================================================================
// Importing the HTTP client
// =================================================================================================

=== Importing The HTTP client

Your application needs a way to communicate with RESTful web services to retrieve their
resources. You will use the https://github.com/axios/axios[axios^] library to provide you with an HTTP client. This client will be used to make HTTP requests to external resources. https://github.com/axios/axios[Axios^] is a promise-based HTTP client that allows you to send asynchronous requests to REST endpoints. Unlike frameworks such as Angular that have a built-in HTTP client, we need to use a third-party vendor HTTP client to render data from an API endpoint. To learn more about the axios library and its HTTP client, visit the https://www.npmjs.com/package/axios[axios documentation^].

Fetchdata.js
[source, javascript, linenums, role='code_column']
----
include::finish/src/main/frontend/src/Components/Fetchdata.js[]
----

The [hotspot=get-posts]`getPosts()` function will utilize the axios API. You also  need to verify that the component was updated properly. This is done through the [hotspot=mount-posts]`componentDidMount()` lifecycle method.

[role="code_command hotspot", subs="quotes"]
----
#Update the `Fetchdata.js` file.#
`src/main/frontend/src/Components/Fetchdata.js`
----
[role="edit_command_text"]
Add the [hotspot=get-posts]`getPosts()` function and [hotspot=mount-posts]`componentDidMount()` 
method into the `Fetchdata` Component. 
The [hotspot=axios]`axios` HTTP call is used to read the artist JSON
containing the data from the sample JSON file in `resources`. Then,
the loading state is changed through the [hotspot=then-method]`.then()` method 
to display the data. On successfully getting a response, the state of 
the system changes by assigning [hotspot=data]`response.data` to [hotspot=data]`posts`
The [hotspot=convert-data]`convertData` function will manipulate the JSON data, to allow it to be accessed.

Once the state is updated, your component will mount all the children elements and component instances to the native UI. You will now have access to the native UI, and will be able to access to your children references, with the ability to trigger a new render pass.

// =================================================================================================
// Displaying the returned data 
// =================================================================================================

=== Displaying the returned data
To display the returned data, you will use the practice of pagination. Pagination is the process of separating content into discrete pages, and it can be used for handling data sets in React. In your application, you will render the columns in the paginated table. 

Display.js
[source, javascript, linenums, role='code_column']
----
include::finish/src/main/frontend/src/Components/Display.js[]
----

[role="code_command hotspot", subs="quotes"]
----
#Create the `Display.js` file.#
`src/main/frontend/src/Components/Fetchdata.js`
----

The [hotspot=table-info]`columns` constant is used to define the table present on the webpage. The table is split into two major sections: the [hotspot=header-artist]`Artist Info Header` and the [hotspot=header-albums]`Albums Header`. Each section defines the [hotspot=header-ID hotspot=header-name hotspot=header-genres hotspot=header-title hotspot=header-tracks]`Headers` for the columns, and the appropriate [hotspot=accessor-ID hotspot=accessor-name hotspot=accessor-followers hotspot=accessor-genres hotspot=accessor-title hotspot=accessor-tracks]`accessors` that respond with the `resources/artists.json`.

The [hotspot=return-table]`return` statement adds the paginated table to your application. Your paginated table is returned as a `<React.Fragment>`, where you have defined the properties for the [hotspot=table]`ReactTable`. The [hotspot=posts]`{posts}` prop corresponds to the consumed data from the API endpoint and is assigned to the `data` of the table. The [hotspot=columns]`{column}` prop corresponds to the rendered column object and is assigned to the `columns` of the table.

// =================================================================================================
// Building the frontend
// =================================================================================================

=== Building the frontend

On successfully building your components, you need to build the frontend by running the Maven `generate-resources` goal:
[role='command']
----
mvn generate-resources
----

Note that you can rebuild the frontend at any time with the Maven `generate-resources` goal.
Any local changes to your JavaScript and HTML are picked up when you build the
frontend.

Navigate to the http://localhost:9080[http://localhost:9080^] URL to view your frontend application.

// =================================================================================================
// Testing the React client
// =================================================================================================

== Testing the React client

No explicit code directly uses the consumed artist JSON, so you don’t need to write any test cases.

Whenever you change and build your React implementation, the frontend application at http://localhost:9080 reflects the changes automatically. You can visit the URL to manually check whether the artist JSON was consumed correctly. You can rebuild only your React frontend by running the following command:

[role='command']
```
mvn generate-resources
```

When you are done checking the application root, exit development mode by pressing CTRL+C in the shell session where you ran the server, or by typing q and then pressing the enter/return key. Likewise, pressing CTRL+C in the shell session that deployed your frontend application will stop the node server. 

Although the React application in this guide is simple, when you build more complex React applications, testing becomes a crucial part of your development lifecycle. If you need to write test cases, follow the official unit testing and end-to-end testing documentation on the official https://reactjs.org/docs/testing.html[React testing document^].

== Great work! You're done!

You have just accessed a simple RESTful web service and consumed its resources by using ReactJS in
Open Liberty.

include::{common-includes}/attribution.adoc[subs="attributes"]




